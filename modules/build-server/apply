pacman -Sy --noconfirm archiso git make nginx vim

if [ -d /opt/arch-server ]; then
  git -C /opt/arch-server pull;
else
  git clone https://github.com/gastrodon/arch-server /opt/arch-server
fi

mkdir -p /etc/nginx/sites-enabled /arch-server/build
cat <<EOF > /arch-server/index.html
<html>
<h3>arch-server: index</h3>
</html>
EOF

cat <<EOF > /arch-server/404.html
<html>
<h3>arch-server: not found</h3>
</html>
EOF

cat <<EOF > /etc/nginx/sites-enabled/default
server {
  listen        80;
  root          /arch-server;
  index         index.html;
  error_log     /home/www-data/logs/nginx_swww.error.log;
  error_page    404    /404.html;

  location /build {
    try_files         $uri =404;
  }
}
EOF

systemctl enable nginx
systemctl restart nginx