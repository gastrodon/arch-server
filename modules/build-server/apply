pacman -Sy --noconfirm archiso git make nginx vim

if [ -d /opt/arch-server ]; then
  git -C /opt/arch-server pull;
else
  git clone https://github.com/gastrodon/arch-server /opt/arch-server
fi

mkdir -p /etc/nginx/sites-enabled
cat <<EOF > /etc/nginx/sites-enabled/default
server {
  listen        8080;
  server_name   www.mysite.com mysite.com;
  error_log     /home/www-data/logs/nginx_www.error.log;
  error_page    404    /404.html;

  location /iso {
    autoindex         on;
    alias             /arch-server/build
    try_files         $uri;
  }
}
EOF

systemctl enable nginx
systemctl restart nginx